<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Excel → Gráficos Interativos (GitHub Pages)</title>
  <style>
    :root{--bg:#0f172a;--panel:#0b1428;--stroke:#1e293b;--muted:#94a3b8;--text:#e2e8f0;--brand:#0284c7;--ok:#22c55e;--warn:#f59e0b}
    *{box-sizing:border-box}
    body{background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0}
    header{padding:12px 16px;border-bottom:1px solid var(--stroke);display:flex;gap:12px;align-items:center}
    .container{max-width:1280px;margin:0 auto;padding:0 12px;width:100%}
    main{display:grid;grid-template-columns:320px 1fr;gap:14px;padding:14px}
    aside{background:linear-gradient(180deg,#0f172a,#0b1325);border:1px solid var(--stroke);border-radius:12px;padding:12px}
    label{font-size:12px;color:var(--muted)}
    select,input[type="text"],input[type="number"],button{width:100%;padding:9px 10px;border-radius:10px;border:1px solid #264161;background:#0b1b34;color:var(--text)}
    button{cursor:pointer;background:var(--brand);border-color:#0ea5e9;font-weight:600}
    button.secondary{background:#1e293b;border:1px solid #64748b}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .stack{display:grid;gap:8px}
    #chartHost{width:100%;height:560px;margin:0 auto;border:1px solid var(--stroke);border-radius:12px;background:linear-gradient(180deg,#0f172a,#0b1325)}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .mini{font-size:12px;opacity:.8}
  </style>
  <noscript>
    <style>main{display:none}</style>
    <div>Este dashboard precisa de JavaScript habilitado.</div>
  </noscript>
  <!-- Bibliotecas locais -->
  <script src="vendor/xlsx.full.min.js"></script>
  <script src="vendor/plotly-2.35.2.min.js"></script>
</head>
<body>
  <header class="container">
    <div style="font-weight:700">Disciplinas Detalhadas — Dashboard</div>
    <div id="status" style="margin-left:auto;font-size:12px;opacity:.85"></div>
  </header>

  <main class="container">
    <aside class="stack">
      <div class="stack">
        <label>Planilha (aba)</label>
        <select id="sheetSelect"></select>
      </div>
      <div class="stack">
        <label>Disciplina</label>
        <select id="subjectSelect"></select>
      </div>
      <div class="row">
        <div class="stack">
          <label>Modo de barras</label>
          <select id="modeSelect">
            <option value="group">Agrupado</option>
            <option value="stack">Empilhado</option>
          </select>
        </div>
        <div class="stack">
          <label>Meta (% ≥6)</label>
          <input id="goalInput" type="number" min="0" max="100" step="1" placeholder="Ex.: 70" />
        </div>
      </div>
      <div class="stack">
        <label>Ações</label>
        <div class="toolbar">
          <span style="margin-left:16px;opacity:.85">Detalhado:</span>
          <button class="secondary det" data-subject="Biologia">Biologia (Qnt + faixas + %)</button>
          <button class="secondary det" data-subject="Física">Física (Qnt + faixas + %)</button>
          <button class="secondary det" data-subject="Matemática">Matemática (Qnt + faixas + %)</button>
          <button class="secondary det" data-subject="Química">Química (Qnt + faixas + %)</button>
          <button class="secondary det" data-subject="Filosofia">Filosofia (Qnt + faixas + %)</button>
          <button class="secondary det" data-subject="Geografia">Geografia (Qnt + faixas + %)</button>
          <button class="secondary det" data-subject="História">História (Qnt + faixas + %)</button>
          <button class="secondary det" data-subject="Sociologia">Sociologia (Qnt + faixas + %)</button>
          <button class="secondary det" data-subject="Arte">Arte (Qnt + faixas + %)</button>
          <button class="secondary det" data-subject="Ed. Física">Ed. Física (Qnt + faixas + %)</button>
          <button class="secondary det" data-subject="Espanhol">Espanhol (Qnt + faixas + %)</button>
          <button class="secondary det" data-subject="Inglês">Inglês (Qnt + faixas + %)</button>
          <button class="secondary det" data-subject="Português">Português (Qnt + faixas + %)</button>
        </div>
        <div class="toolbar">
          <button id="btnDownload">Baixar PNG</button>
          <button id="btnExport">Exportar CSV</button>
        </div>
        <div class="mini">Dica: clique na legenda para ocultar/exibir séries. Preferência salva automaticamente.</div>
      </div>
    </aside>

    <section id="chartHost"></section>
  </main>

<script>
// (restante do código JS segue igual)
// Liga os botões de disciplinas detalhadas sem alterar a lógica existente.
document.addEventListener('DOMContentLoaded', function(){
  try{
    document.querySelectorAll('button.det[data-subject]')
      .forEach(btn=> btn.addEventListener('click', ()=>{
        const s = btn.getAttribute('data-subject');
        if(typeof plotDetailed === 'function'){
          console.log('Acionando plotDetailed para', s);
          plotDetailed(s);
        }else{
          alert('Função plotDetailed não encontrada no escopo atual.');
        }
      }));
  }catch(e){ console.error('Erro ao ligar botões detalhados:', e); }
});
</script>
</body>
</html>
